{"id":"sqlflight-0ki","title":"Parser: snowflake.rs has stub implementations","description":"parse_qualify() and parse_flatten() in snowflake.rs return errors with 'not implemented' messages. These should be removed or redirected to use the actual implementations in stmt.rs that properly handle these clauses.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T19:43:46.755406-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:43:46.755406-06:00"}
{"id":"sqlflight-2oj","title":"Error tests: Improve edge case tests to assert specific outcomes","description":"In tests/error_tests.rs, the edge_cases module has tests that use 'assert\\!(result.is_ok() || result.is_err())' which always passes. These should be updated to document and assert the expected behavior for: empty_input, whitespace_only, comment_only, very_long_identifier, deeply_nested_subqueries, many_columns, unicode_identifiers, string_with_special_chars, and multiple_statements.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T19:43:42.55929-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:43:42.55929-06:00"}
{"id":"sqlflight-5gq","title":"Split formatter mod.rs (3150 lines) into smaller modules","description":"The formatter mod.rs is too large (3150 lines) to fit in Claude's context. Split into logical modules:\n\n## Current structure:\n- StatementBoundary struct (lines 19-26)\n- format_sql/format_sql_with_depth functions (lines 27-393)\n- Jinja extraction functions (lines 394-605)\n- Comment handling (lines 607-759)\n- Formatter struct + impl (lines 767-2802) - LARGEST SECTION\n- Utility functions (lines 2803-end)\n\n## Proposed split:\n1. `mod.rs` - Re-exports and public API (format_sql, format_ast)\n2. `jinja.rs` - Jinja placeholder extraction and handling\n3. `comments.rs` - Comment mapping and hint insertion\n4. `statements.rs` - Statement-level formatting logic\n5. `expressions.rs` - Expression formatting (format_expr and helpers)\n6. `clauses.rs` - SQL clause formatting (SELECT, FROM, WHERE, etc.)\n7. `utils.rs` - Utility functions (is_jinja_placeholder, format_identifier, etc.)\n\n## Approach:\n- Move code incrementally, one module at a time\n- Run tests after each move to ensure no regressions\n- Keep internal visibility where needed","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T20:21:03.380959-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T20:21:03.380959-06:00"}
{"id":"sqlflight-8pd","title":"Duplicate file discovery functions in main.rs and cli/mod.rs","description":"There are two file discovery functions:\n1. discover_sql_files in main.rs (lines 141-173) - used by the CLI\n2. discover_files in cli/mod.rs (line 36) - not used\n\nThe cli/mod.rs function is never called. Either:\n- The main.rs function should be moved to cli/mod.rs and reused, OR\n- The unused function in cli/mod.rs should be removed\n\nThis is a code cleanup/refactoring issue.","status":"open","priority":2,"issue_type":"chore","created_at":"2026-01-08T19:45:41.79675-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:45:41.79675-06:00"}
{"id":"sqlflight-aot","title":"Error handling: Add span information to all ParseError instances","description":"Many ParseError instances in stmt.rs are created with span: None instead of actual position information. The spec requires 'fail fast with descriptive error messages' and the error.rs has utilities (offset_to_line_col, format_parse_error) that need span data to work properly. Examples in stmt.rs lines 182, 558, 564, 634, etc.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-08T19:43:29.389129-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:43:29.389129-06:00"}
{"id":"sqlflight-b4t","title":"CLI silently succeeds when given nonexistent files","description":"When running 'sqlflight fmt /nonexistent/file.sql', the CLI returns exit code 0 with no output instead of reporting an error. The discover_sql_files function returns an empty Vec when the path doesn't exist (not a file, not a directory, glob doesn't match), causing the main loop to do nothing and exit successfully. Expected behavior: report an error and exit with non-zero code.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-08T19:45:20.948775-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:45:20.948775-06:00"}
{"id":"sqlflight-bk9","title":"snowflake.rs helper functions are stubs returning errors","description":"The file src/parser/snowflake.rs contains parse_qualify and parse_flatten functions that are stubs returning 'not implemented' errors. However, these features are actually implemented in stmt.rs (parse_qualify_clause and parse_table_reference with Flatten handling). The snowflake.rs file should either be updated to use the real implementations or removed if not needed.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T19:43:35.81255-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:43:35.81255-06:00"}
{"id":"sqlflight-cb8","title":"Parser: ALTER TABLE only supports ADD and DROP column","description":"ALTER TABLE parsing in stmt.rs only supports ADD and DROP column actions. Missing RENAME, MODIFY, SET, UNSET and other ALTER TABLE actions per Snowflake DDL specifications.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T19:43:47.977545-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:43:47.977545-06:00"}
{"id":"sqlflight-cpg","title":"AST: Add support for RESULT_SCAN and GENERATOR table functions","description":"The SPEC.md mentions RESULT_SCAN and GENERATOR as Snowflake-specific features that should be supported. While the AST has TableFunction support which could handle these, there are no specific tests or dedicated handling for these special Snowflake functions.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T19:43:21.411549-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:43:21.411549-06:00"}
{"id":"sqlflight-muz","title":"SQL inside Jinja block-forming tags is not formatted - content preserved verbatim","description":"## Problem\n\nSQL content inside Jinja block-forming tags is NOT formatted. The content is extracted as a single placeholder and preserved verbatim.\n\n## Expected Behavior\n\nSQL inside these blocks should be formatted the same as standalone SQL.\n\n## Root Cause\n\nIn src/jinja/extract.rs, block-forming tags are extracted as a single placeholder including all content between start and end tags. The content is never parsed or formatted as SQL.\n\n## Affected Tags\n\n- {% set name %}...{% endset %} (block form without =)\n- {% macro %}...{% endmacro %}\n- {% for %}...{% endfor %}\n- {% if %}...{% endif %}\n\n## Tests Documenting This\n\n- jinja_cte_formatting::cte_inside_jinja_set_block_not_formatted\n- jinja_cte_formatting::group_by_inside_jinja_set_block_not_formatted","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T19:43:03.789698-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T20:28:33.781049-06:00","closed_at":"2026-01-08T20:28:33.781049-06:00","close_reason":"Fixed in commit 37c3ecb"}
{"id":"sqlflight-s6j","title":"CLI integration tests are not being discovered by cargo","description":"The integration tests in tests/integration/cli_tests.rs are not being discovered by cargo because they use a mod.rs pattern which doesn't work for integration tests. Integration tests must either be files directly in tests/ directory or declared via [[test]] in Cargo.toml. The cli_tests.rs file should be moved to tests/cli_tests.rs.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-08T19:44:52.7842-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T19:44:52.7842-06:00"}
{"id":"sqlflight-ukg","title":"Set blocks nested inside for/if/macro do not have SQL formatted","description":"When a {% set x %}SQL{% endset %} block is nested inside other Jinja blocks like {% if %}, {% for %}, or {% macro %}, the SQL inside the set block is NOT formatted. This is because the outer block (if/for/macro) is preserved verbatim, so the inner set block is never processed for SQL formatting.\n\nExample input:\n{% if condition %}{% set x %}SELECT   *   FROM   users{% endset %}{% endif %}\n\nExpected output:\n{% if condition %}{% set x %}select * from users{% endset %}{% endif %}\n\nActual output:\n{% if condition %}{% set x %}SELECT   *   FROM   users{% endset %}{% endif %} (unformatted)\n\nThe fix would require recursively processing block-forming tags within verbatim blocks to find nested SQL-formatting blocks.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-08T20:26:11.506923-06:00","created_by":"mfh/refinery","updated_at":"2026-01-08T20:26:11.506923-06:00","dependencies":[{"issue_id":"sqlflight-ukg","depends_on_id":"sqlflight-muz","type":"blocks","created_at":"2026-01-08T20:26:11.509949-06:00","created_by":"mfh/refinery"}]}
